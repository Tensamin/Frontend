# Maintainer: Alois <aloisianer@proton.me>
pkgname=tensamin-git
_pkgname=tensamin
pkgver=0
pkgrel=1
pkgdesc="True E2EE, decentralized messages. Open source and privacy first."
arch=('x86_64')
url="https://tensamin.net"
license=('custom')
depends=('gtk3' 'nss' 'libxss' 'libxtst' 'xdg-utils' 'libappindicator-gtk3' 'libsecret')
makedepends=('git' 'npm' 'dpkg' 'fakeroot')
provides=('tensamin')
conflicts=('tensamin' 'tensamin-bin')
source=("git+https://github.com/Tensamin/Frontend.git")
sha256sums=('SKIP')

pkgver() {
	cd "$srcdir/Frontend"
	git rev-parse HEAD | cut -c1-6
}

build() {
	command -v bun >/dev/null 2>&1 || sudo npm i -g bun

	cd "$srcdir/Frontend"
	bun install
	bun run build
	
	cd desktop
	bun install
	bun run build:git
}

package() {
	cd "$srcdir/Frontend/desktop/out"
	debfile=$(find "$PWD" -path '*zip/linux/x64/*.deb' -print -quit)
	ar x "${debfile}"
	bsdtar -xf "$debfile" -C "${pkgdir}/opt/${_pkgname}"
	tar --zstd -xf data.tar.zst -C "${pkgdir}"
}
