# Maintainer: Alois <aloisianer@proton.me>
pkgname=tensamin-git
pkgver=0.1.3.r0.g0000000
pkgrel=1
pkgdesc="True E2EE, decentralized messages. Open source and privacy first."
arch=('x86_64')
url="https://tensamin.net"
license=('custom')
depends=('gtk3' 'nss' 'libxss' 'libxtst' 'xdg-utils' 'libappindicator-gtk3' 'libsecret')
makedepends=('git' 'bun' 'nodejs' 'npm' 'python')
provides=('tensamin')
conflicts=('tensamin' 'tensamin-bin')
source=("git+https://github.com/Tensamin/Frontend.git")
sha256sums=('SKIP')

pkgver() {
	cd "Frontend"
	git describe --long --tags | sed 's/\([^-]*-g\)/r\1/;s/-/./g'
}

prepare() {
	cd "Frontend"
	bun install
	cd desktop
	bun install
}

build() {
	cd "Frontend"
	bun run build
	
	cd desktop
	rm -rf build && mkdir build
	cp -r ../dist/* ./build/
	
	# Build the linux target (unpacked)
	bunx electron-forge package --platform=linux --arch=x64
}

package() {
	cd "Frontend/desktop/out/tensamin-linux-x64"
	
	install -dm755 "${pkgdir}/usr/lib/tensamin"
	cp -r . "${pkgdir}/usr/lib/tensamin/"
	
	install -dm755 "${pkgdir}/usr/bin"
	ln -s /usr/lib/tensamin/tensamin "${pkgdir}/usr/bin/tensamin"
	
	# Install .desktop file and icons if they exist
	# Assuming electron-forge handles resources, but we might need to manually copy them if we just use 'package'
	# For now, this is a basic git package.
}
